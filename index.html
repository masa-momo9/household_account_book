<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シンプル家計簿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 5px;
            font-size: 24px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .balance {
            text-align: center;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .balance-amount {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px;
            width: 100%;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .transaction-type {
            display: flex;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .transaction-type label {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            margin: 0;
            transition: background-color 0.3s;
        }
        
        .transaction-type input {
            display: none;
        }
        
        .transaction-type input:checked + label {
            background-color: #3498db;
            color: white;
        }
        
        .transaction-list {
            list-style: none;
        }
        
        .transaction-item {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info {
            flex: 1;
        }
        
        .transaction-title {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .transaction-date {
            font-size: 12px;
            color: #777;
        }
        
        .transaction-amount {
            font-weight: bold;
            margin-right: 15px;
        }
        
        .expense {
            color: #e74c3c;
        }
        
        .income {
            color: #2ecc71;
        }
        
        .section-title {
            margin-bottom: 15px;
            color: #333;
            font-weight: normal;
            font-size: 18px;
        }
        
        .message {
            text-align: center;
            padding: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            border-radius: 4px;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        
        .message.show {
            opacity: 1;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .delete-btn:hover {
            background-color: #c0392b;
        }
        
        .transaction-right {
            display: flex;
            align-items: center;
        }
        
        /* 確認モーダル */
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .confirm-dialog {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 300px;
            text-align: center;
        }
        
        .confirm-message {
            margin-bottom: 20px;
        }
        
        .confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .confirm-btn {
            padding: 8px 15px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
        }
        
        .confirm-cancel {
            background-color: #95a5a6;
            color: white;
        }
        
        .confirm-delete {
            background-color: #e74c3c;
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <h1>シンプル家計簿</h1>
        <p>大学生の一人暮らしに</p>
    </header>
    
    <div class="card">
        <div class="balance">残高</div>
        <div class="balance-amount" id="totalBalance">¥0</div>
    </div>
    
    <div class="card">
        <h2 class="section-title">新しい取引を追加</h2>
        
        <div class="transaction-type">
            <input type="radio" id="expense" name="type" value="expense" checked>
            <label for="expense">支出</label>
            
            <input type="radio" id="income" name="type" value="income">
            <label for="income">収入</label>
        </div>
        
        <div class="form-group">
            <label for="amount">金額</label>
            <input type="number" id="amount" placeholder="例: 1000">
        </div>
        
        <div class="form-group">
            <label for="category">カテゴリー</label>
            <select id="category">
                <option value="food">食費</option>
                <option value="transport">交通費</option>
                <option value="entertainment">娯楽</option>
                <option value="daily">日用品</option>
                <option value="income" style="display:none;">収入</option>
                <option value="other">その他</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="memo">メモ</label>
            <input type="text" id="memo" placeholder="例: コンビニ食事">
        </div>
        
        <div class="form-group">
            <label for="date">日付</label>
            <input type="date" id="date">
        </div>
        
        <button id="addButton">追加する</button>
    </div>
    
    <div class="card">
        <h2 class="section-title">最近の取引</h2>
        <ul class="transaction-list" id="transactionList">
            <!-- 取引履歴はJavaScriptで生成されます -->
        </ul>
    </div>
    
    <div class="message" id="message"></div>
    
    <!-- 確認モーダル -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-dialog">
            <div class="confirm-message">この取引を削除しますか？</div>
            <div class="confirm-buttons">
                <button class="confirm-btn confirm-cancel" id="cancelDelete">キャンセル</button>
                <button class="confirm-btn confirm-delete" id="confirmDelete">削除</button>
            </div>
        </div>
    </div>
    
    <script>
        // DOM要素の参照を取得
        const typeRadios = document.querySelectorAll('input[name="type"]');
        const amountInput = document.getElementById('amount');
        const categorySelect = document.getElementById('category');
        const memoInput = document.getElementById('memo');
        const dateInput = document.getElementById('date');
        const addButton = document.getElementById('addButton');
        const transactionList = document.getElementById('transactionList');
        const totalBalanceElement = document.getElementById('totalBalance');
        const messageElement = document.getElementById('message');
        const confirmModal = document.getElementById('confirmModal');
        const cancelDeleteBtn = document.getElementById('cancelDelete');
        const confirmDeleteBtn = document.getElementById('confirmDelete');
        
        // 削除対象のID
        let deleteTargetId = null;
        
        // 今日の日付をデフォルト値として設定
        dateInput.value = new Date().toISOString().split('T')[0];
        
        // 取引タイプの変更イベント
        typeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                const incomeOption = categorySelect.querySelector('option[value="income"]');
                
                if (this.value === 'income') {
                    // 収入の場合、カテゴリーを「収入」に固定
                    Array.from(categorySelect.options).forEach(option => {
                        option.style.display = option.value === 'income' ? '' : 'none';
                    });
                    incomeOption.style.display = '';
                    incomeOption.selected = true;
                } else {
                    // 支出の場合、「収入」カテゴリー以外を表示
                    Array.from(categorySelect.options).forEach(option => {
                        option.style.display = option.value === 'income' ? 'none' : '';
                    });
                    
                    if (categorySelect.value === 'income') {
                        categorySelect.value = 'food';
                    }
                }
            });
        });
        
        // 追加ボタンのクリックイベント
        addButton.addEventListener('click', function() {
            const type = document.querySelector('input[name="type"]:checked').value;
            const amount = parseFloat(amountInput.value);
            const category = categorySelect.value;
            const memo = memoInput.value;
            const date = dateInput.value;
            
            // 入力チェック
            if (!amount || amount <= 0) {
                showMessage('金額を正しく入力してください');
                return;
            }
            
            if (!memo) {
                showMessage('メモを入力してください');
                return;
            }
            
            if (!date) {
                showMessage('日付を選択してください');
                return;
            }
            
            // 取引データを作成
            const transaction = {
                id: Date.now(),
                type: type,
                amount: amount,
                category: category,
                memo: memo,
                date: date,
                timestamp: new Date(date).getTime()
            };
            
            // 取引を保存
            saveTransaction(transaction);
            
            // UI更新
            updateTransactionList();
            updateBalance();
            
            // フォームをリセット
            amountInput.value = '';
            memoInput.value = '';
            
            showMessage('取引を追加しました');
        });
        
        // 削除キャンセルボタンのクリックイベント
        cancelDeleteBtn.addEventListener('click', function() {
            confirmModal.style.display = 'none';
            deleteTargetId = null;
        });
        
        // 削除確認ボタンのクリックイベント
        confirmDeleteBtn.addEventListener('click', function() {
            if (deleteTargetId) {
                deleteTransaction(deleteTargetId);
                confirmModal.style.display = 'none';
                deleteTargetId = null;
                
                // UI更新
                updateTransactionList();
                updateBalance();
                
                showMessage('取引を削除しました');
            }
        });
        
        // 取引を保存する関数
        function saveTransaction(transaction) {
            let transactions = getTransactions();
            transactions.unshift(transaction); // 新しい取引を配列の先頭に追加
            localStorage.setItem('simpleTransactions', JSON.stringify(transactions));
        }
        
        // 取引を削除する関数
        function deleteTransaction(id) {
            let transactions = getTransactions();
            transactions = transactions.filter(transaction => transaction.id != id);
            localStorage.setItem('simpleTransactions', JSON.stringify(transactions));
        }
        
        // 取引データを取得する関数
        function getTransactions() {
            const transactionsJSON = localStorage.getItem('simpleTransactions');
            if (transactionsJSON) {
                return JSON.parse(transactionsJSON);
            }
            return [];
        }
        
        // 取引リストを更新する関数
        function updateTransactionList() {
            const transactions = getTransactions();
            transactionList.innerHTML = '';
            
            if (transactions.length === 0) {
                transactionList.innerHTML = '<p style="text-align: center; color: #777; padding: 10px;">取引データがありません</p>';
                return;
            }
            
            // 最新10件のみ表示
            const recentTransactions = transactions.slice(0, 10);
            
            recentTransactions.forEach(transaction => {
                const li = document.createElement('li');
                li.className = 'transaction-item';
                
                li.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-title">${transaction.memo}</div>
                        <div class="transaction-date">${formatDate(transaction.date)}</div>
                    </div>
                    <div class="transaction-right">
                        <div class="transaction-amount ${transaction.type === 'expense' ? 'expense' : 'income'}">
                            ${transaction.type === 'expense' ? '-' : '+'}¥${transaction.amount.toLocaleString()}
                        </div>
                        <button class="delete-btn" data-id="${transaction.id}">×</button>
                    </div>
                `;
                
                transactionList.appendChild(li);
            });
            
            // 削除ボタンにイベントリスナーを設定
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    deleteTargetId = this.getAttribute('data-id');
                    confirmModal.style.display = 'flex';
                });
            });
        }
        
        // 残高を更新する関数
        function updateBalance() {
            const transactions = getTransactions();
            let balance = 0;
            
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    balance += transaction.amount;
                } else {
                    balance -= transaction.amount;
                }
            });
            
            totalBalanceElement.textContent = `¥${balance.toLocaleString()}`;
        }
        
        // 日付をフォーマットする関数
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            
            // 日付をYYYY-MM-DD形式に変換
            const formatYMD = (d) => {
                return d.getFullYear() + '-' + 
                       String(d.getMonth() + 1).padStart(2, '0') + '-' + 
                       String(d.getDate()).padStart(2, '0');
            };
            
            if (formatYMD(date) === formatYMD(today)) {
                return '今日';
            } else if (formatYMD(date) === formatYMD(yesterday)) {
                return '昨日';
            } else {
                return `${date.getMonth() + 1}月${date.getDate()}日`;
            }
        }
        
        // メッセージを表示する関数
        function showMessage(text) {
            messageElement.textContent = text;
            messageElement.classList.add('show');
            
            setTimeout(() => {
                messageElement.classList.remove('show');
            }, 3000);
        }
        
        // サンプルデータの初期化（初回のみ）
        function initSampleData() {
            if (!localStorage.getItem('simpleTransactions')) {
                const sampleTransactions = [
                    {
                        id: 1,
                        type: 'expense',
                        amount: 550,
                        category: 'food',
                        memo: '昼食（学食）',
                        date: new Date().toISOString().split('T')[0],
                        timestamp: new Date().getTime()
                    },
                    {
                        id: 2,
                        type: 'expense',
                        amount: 480,
                        category: 'transport',
                        memo: '電車（往復）',
                        date: new Date().toISOString().split('T')[0],
                        timestamp: new Date().getTime() - 3600000
                    },
                    {
                        id: 3,
                        type: 'income',
                        amount: 28000,
                        category: 'income',
                        memo: 'アルバイト収入',
                        date: new Date(new Date().setDate(new Date().getDate() - 5)).toISOString().split('T')[0],
                        timestamp: new Date().getTime() - 432000000
                    }
                ];
                
                localStorage.setItem('simpleTransactions', JSON.stringify(sampleTransactions));
            }
        }
        
        // アプリの初期化
        function init() {
            // サンプルデータ初期化
            initSampleData();
            
            // UI更新
            updateTransactionList();
            updateBalance();
        }
        
        // ページ読み込み時に初期化を実行
        document.addEventListener('DOMContentLoaded', init);
        
        // すぐに初期化も実行（念のため）
        init();
    </script>
</body>
</html>